<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Fixed-weight DSMC simulations · Merzbild</title><meta name="title" content="Fixed-weight DSMC simulations · Merzbild"/><meta property="og:title" content="Fixed-weight DSMC simulations · Merzbild"/><meta property="twitter:title" content="Fixed-weight DSMC simulations · Merzbild"/><meta name="description" content="Documentation for Merzbild."/><meta property="og:description" content="Documentation for Merzbild."/><meta property="twitter:description" content="Documentation for Merzbild."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Merzbild</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../overview_capabilities/">Overview of capabilities</a></li><li><span class="tocitem">Getting started</span><ul><li><a class="tocitem" href="../overview_blocks/">Overview of basic building blocks</a></li><li class="is-active"><a class="tocitem" href>Fixed-weight DSMC simulations</a><ul class="internal"><li><a class="tocitem" href="#Loading-interaction-data:-Interaction"><span>Loading interaction data: Interaction</span></a></li><li><a class="tocitem" href="#Storing-intermediate-collision-data:-CollisionData"><span>Storing intermediate collision data: CollisionData</span></a></li><li><a class="tocitem" href="#NTC-specific-data:-CollisionFactors"><span>NTC-specific data: CollisionFactors</span></a></li><li><a class="tocitem" href="#NTC-collisions"><span>NTC collisions</span></a></li><li><a class="tocitem" href="#Example:-bringing-it-all-together"><span>Example: bringing it all together</span></a></li><li><a class="tocitem" href="#Summary"><span>Summary</span></a></li></ul></li><li><a class="tocitem" href="../overview_varweight/">Variable-weight DSMC simulations</a></li><li><a class="tocitem" href="../overview_1d/">1D DSMC simulations</a></li><li><a class="tocitem" href="../overview_fp/">Fokker-Planck simulations</a></li></ul></li><li><a class="tocitem" href="../reference_public/">Public API reference</a></li><li><a class="tocitem" href="../reference_internal/">Internal API reference</a></li><li><a class="tocitem" href="../benchmarks/">Benchmarks</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Getting started</a></li><li class="is-active"><a href>Fixed-weight DSMC simulations</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Fixed-weight DSMC simulations</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Fixed-weight-DSMC-simulations"><a class="docs-heading-anchor" href="#Fixed-weight-DSMC-simulations">Fixed-weight DSMC simulations</a><a id="Fixed-weight-DSMC-simulations-1"></a><a class="docs-heading-anchor-permalink" href="#Fixed-weight-DSMC-simulations" title="Permalink"></a></h1><p>Now that we can load species data, sample and index particles and compute macroscopic properties, we now look at performing collisions. Currently, the No Time Counter (NTC) algorithm of Bird is implemented for fixed-weight DSMC simulations.</p><h2 id="Loading-interaction-data:-Interaction"><a class="docs-heading-anchor" href="#Loading-interaction-data:-Interaction">Loading interaction data: Interaction</a><a id="Loading-interaction-data:-Interaction-1"></a><a class="docs-heading-anchor-permalink" href="#Loading-interaction-data:-Interaction" title="Permalink"></a></h2><p>First, we need to load interaction data for the species the collisions of which we want to model. This data includes things like the collision-reduced mass and VHS parameters. The VHS parameters are collision species pair-specific. These data are stored in an <code>Interaction</code> instance. These <code>Interaction</code> instances are stored in a <code>n_species x n_species</code> matrix, where the <code>(i,j)</code>-th element contains the interaction data for collisions of particles of species <code>i</code> with  particles of species <code>j</code>.</p><p>We can use the <a href="../reference_public/#Merzbild.load_interaction_data"><code>load_interaction_data</code></a> function to create such a matrix of <code>Interaction</code> instances. It which reads a TOML file with the relevant interaction information, and uses the (already loaded) species data to compute quantities such as the collision-reduced mass. One can also use <a href="../reference_public/#Merzbild.load_interaction_data_with_dummy"><code>load_interaction_data_with_dummy</code></a> function, which will not throw an error in case data for a specific interaction is missing in the TOML file, but will just create an interaction using the passed dummy parameters. This is relevant for electron-neutral interactions, for example, since  VHS collision parameters don&#39;t really make sense for such interactions, but are required to fill in the fields.</p><h2 id="Storing-intermediate-collision-data:-CollisionData"><a class="docs-heading-anchor" href="#Storing-intermediate-collision-data:-CollisionData">Storing intermediate collision data: CollisionData</a><a id="Storing-intermediate-collision-data:-CollisionData-1"></a><a class="docs-heading-anchor-permalink" href="#Storing-intermediate-collision-data:-CollisionData" title="Permalink"></a></h2><p>During collisions, multiple vector quantities (such as the center of mass velocity, pre- and post-collision relative velocity) are computed for multiple collision pairs. In order to avoid excessive allocations and keep track of these quantities, the <code>CollisionData</code> structure exists. It does not need to be initialized in any special way; an instance of <code>CollisionData</code> must be created and simply passed to the collision routine, which will use it as required.</p><h2 id="NTC-specific-data:-CollisionFactors"><a class="docs-heading-anchor" href="#NTC-specific-data:-CollisionFactors">NTC-specific data: CollisionFactors</a><a id="NTC-specific-data:-CollisionFactors-1"></a><a class="docs-heading-anchor-permalink" href="#NTC-specific-data:-CollisionFactors" title="Permalink"></a></h2><p>The No-Time Counter (NTC) collision algorithm requires an estimate of <span>$(\sigma g w)_{max}$</span> for each species pair for each cell in the flow. The <code>CollisionFactors</code> data structure stores the values of this factor, as well as  other NTC-related parameters (number of collisions performed, number of collision partners). One needs to initialize a 3-dimensional array of <code>CollisionFactors</code> of shape  <code>n_species x n_species x n_cells</code> in order to store the required factors for each species&#39; pair for all cells in the flow; this is done by calling <code>create_collision_factors_array(n_species, n_cells)</code>. Some initial estimate for the values of <span>$(\sigma g w)_{max}$</span>; the simplest way to do so for a fixed-weight DSMC simulation is to call the <code>estimate_sigma_g_w_max!(collision_factors, interactions, species_data, T_list, Fnum; mult_factor=1.0)</code> function.</p><p>This will pre-compute  <span>$(\sigma g w)_{max}$</span> based on a list of temperatures for each species by computing the average thermal velocities and calculating the value of the VHS collision cross-section:</p><pre><code class="language-julia hljs">g_thermal1 = sqrt(2 * T1 * k_B / species1.mass)
g_thermal2 = sqrt(2 * T2 * k_B / species2.mass)
g_thermal = 0.5 * (g_thermal1 + g_thermal2)
return mult_factor * sigma_vhs(interaction, g_thermal) * g_thermal * Fnum</code></pre><p>Here <code>mult_factor</code> (default value of 1.0) is used to optionally increase or decrease the computed estimate; and the value <span>$w$</span> is assumed to be constant and is designated by <code>Fnum</code>. This approach computes the same value of <span>$(\sigma g w)_{max}$</span> for all the cells in the domain; however, unless an initial condition with large gradients is used, this should not be an issue.</p><h2 id="NTC-collisions"><a class="docs-heading-anchor" href="#NTC-collisions">NTC collisions</a><a id="NTC-collisions-1"></a><a class="docs-heading-anchor-permalink" href="#NTC-collisions" title="Permalink"></a></h2><p>Now that the interaction data has been loaded, the <code>CollisionData</code> instance to store intermediate collision-related quantities has been instantiated, the 3-dimensional array of <code>CollisionFactors</code> has been created, and the <span>$(\sigma g w)_{max}$</span> values precomputed, one can perform collisions.</p><p>Single-species elastic VHS collisions can be performed by calling <code>ntc!(rng, collision_factors, collision_data, interaction, particles, pia, cell, species, Δt, V)</code>. Here <code>collision_factors</code> is the specific instance of <code>CollisionFactors</code>, i.e. a specific element of the 3-dimensional array of <code>CollisionFactors</code>. <code>Δt</code> is the timestep, and <code>V</code> is the volume of the physical cell (for spatially homogeneous simulations this can be set to 1.0).</p><p>Multi-species elastic VHS collisions are performed in a similar fashion, by calling <code>ntc!(rng, collision_factors, collision_data, interaction, particles_1, particles_2, pia, cell, species1, species2, Δt, V)</code>.</p><h2 id="Example:-bringing-it-all-together"><a class="docs-heading-anchor" href="#Example:-bringing-it-all-together">Example: bringing it all together</a><a id="Example:-bringing-it-all-together-1"></a><a class="docs-heading-anchor-permalink" href="#Example:-bringing-it-all-together" title="Permalink"></a></h2><p>An example of computation of collisions for a two-species mixture is presented here.</p><pre><code class="language-julia hljs">using Merzbild
using Random

seed = 1
Random.seed!(seed)
rng = Xoshiro(seed)

species_data = load_species_data(&quot;data/particles.toml&quot;, [&quot;Ar&quot;, &quot;He&quot;])
n_species = length(species_data)

# number of timesteps to run simulation for
n_t = 5000

# we will have the number density of argon = 1e15, the number density of helium = 5e15
n_particles_Ar = 2000
n_particles_He = 10000
Fnum = 5e11

# initial temperatures
T0_Ar = 300.0
T0_He = 2000.0
T0_list = [T0_Ar, T0_He]

# create the 2-element Vector of ParticleVectors for the 2 species
particles = [ParticleVector(n_particles_Ar), ParticleVector(n_particles_He)]

# create the 2-species 1-cell particle indexer array filled with zeros
# as we haven&#39;t sampled any particles yet
pia = ParticleIndexerArray([0, 0])

# sample particles from a Maxwellian distribution
sample_particles_equal_weight!(rng, particles[1], pia, 1, 2, n_particles_Ar,
                               species_data[1].mass, T0_Ar, Fnum,
                               0.0, 1.0, 0.0, 1.0, 0.0, 1.0)
sample_particles_equal_weight!(rng, particles[2], pia, 1, 2, n_particles_He,
                               species_data[2].mass, T0_He, Fnum,
                               0.0, 1.0, 0.0, 1.0, 0.0, 1.0)


# create the PhysProps instance to store computed properties
phys_props = PhysProps(1, 2, [], Tref=T0_Ar)

# create struct for I/O
ds = NCDataHolder(&quot;2species.nc&quot;, species_data, phys_props)

# compute and write physical properties at t=0
compute_props!(particles, pia, species_data, phys_props)
write_netcdf_phys_props(ds, phys_props, 0)

# load interaction data
interaction_data = load_interaction_data(&quot;data/vhs.toml&quot;, species_data)

# create the 3-D array of collision factors
collision_factors::Array{CollisionFactors, 3} = create_collision_factors_array(n_species)

# create the structure to store temporary collision data
collision_data = CollisionData()

# estimate  (σ(g) * g * w)_max
estimate_sigma_g_w_max!(collision_factors, interaction_data, species_data, T0_list, Fnum)

# set our timestep
Δt = 2.5e-3

# set cell volume to 1.0 as we&#39;re doing a 0-D simulation
V = 1.0

for ts in 1:n_t  # loop over time
    for s2 in 1:n_species  # loop over first species
        for s1 in s2:n_species  # loop over second species
            if (s1 == s2)
                # collisions between particles of same species
                ntc!(rng, collision_factors[s1,s1,1], collision_data,
                     interaction_data, particles[s1], pia, 1, s1, Δt, V)
            else
                # collisions between particles of different species
                ntc!(rng, collision_factors[s1,s2,1], collision_data,
                     interaction_data, particles[s1], particles[s2],
                     pia, 1, s1, s2, Δt, V)
            end
        end
    end

    # we don&#39;t do convection, so we can take advantage of the fact that the particles stay sorted
    # and compute the physical properties slightly faster without having to sort the particles
    compute_props_sorted!(particles, pia, species_data, phys_props)

    # write to output
    write_netcdf_phys_props(ds, phys_props, ts)
end

# close output file
close_netcdf(ds)</code></pre><h2 id="Summary"><a class="docs-heading-anchor" href="#Summary">Summary</a><a id="Summary-1"></a><a class="docs-heading-anchor-permalink" href="#Summary" title="Permalink"></a></h2><p>Now we have an overview of how to</p><ol><li>Load interaction-related data</li><li>Estimate the factor required for the NTC collision algorithm</li><li>Perform elastic collisions between particles of alike and unalike species</li></ol><p>In the next section, an overview of simulating collisions with variable-weight particles will be given.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../overview_blocks/">« Overview of basic building blocks</a><a class="docs-footer-nextpage" href="../overview_varweight/">Variable-weight DSMC simulations »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Wednesday 11 December 2024 21:43">Wednesday 11 December 2024</span>. Using Julia version 1.11.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
